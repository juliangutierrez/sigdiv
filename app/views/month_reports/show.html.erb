<div class="pull-left"><%= image_tag 'logo_niteroi.jpg' %></div>
<div class="pull-left">
	<h2>PREFEITURA NITERÓI</h2>
	<h2>SECRETARIA MUNICIPAL DE FAZENDA</h2>
</div>

<div class="clearfix"></div>

<h3>A - Identificação do Contrato</h3>
<div class="card-group">
  <div class="card">
    <div class="card-body">
      <p class="card-text"><strong>Tipo: </strong><%= @debt.category %></p>
      <p class="card-text"><strong>Mutuário: </strong>Prefeitura Municipal de Niterói</p>
      <p class="card-text"><strong>Credor: </strong><%= @debt.creditor.name %></p>
      <p class="card-text"><strong>Valor do Contrato: </strong><%= @debt.contract_value %></p>
      <p class="card-text"><strong>Fator de Conversão do Mês (moeda original) REAL </strong>-</p>
      <p class="card-text"><strong>Fator de Conversão do Mês (em Real)</strong>-</p>
      <p class="card-text"><strong>Taxa de Encargos: </strong>
      	<%= @debt.transaction_infos.reduce('') { |result, info| info.charge? ? result + "#{info.description}: #{info.formula}. " : result } %></p>
      <p class="card-text"><strong>Taxa de juros:</strong><%= @debt.interest_rate %></p>
      <p class="card-text"><strong>Forma de Pagamento: </strong><%= @debt.amortization_type %></p>
      <p class="card-text"><strong>Objetivo da Operação: </strong><%= @debt.purpose %></p>
      <p class="card-text"><strong>Posição em: </strong><%= Date.today %></p>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <p class="card-text"><strong>Data da Assinatura: </strong><%= @debt.signature_date %></p>
      <p class="card-text"><strong>Agente Financeiro: </strong><%= @debt.creditor.name %></p>
      <p class="card-text"><strong>Moeda Original: </strong><%= @debt.currency.name %></p>
      <p class="card-text"><strong>Prazo de Carência: </strong><%= @debt.grace_period %></p>
      <p class="card-text"><strong>Prazo de Amortização:</strong><%= @debt.amortization_period %></p>
    </div>
  </div>
</div>

<h3>B - Esquema de Liberação de Recursos</h3>
<h4>1 - Parcelas Recebidas </h4>

<table class="table table-striped" class="table table-striped">
	<thead>
		<tr>
			<th>Mês/Ano</th>
			<th>Valores - Moeda Original</th>
			<th>Valores em R$</th>
		</tr>
	</thead>
	<tbody>
		<% sum_values = 0 %>
		<% sum_values_brl = 0 %>
		<% @debt.withdraws_values_by_year.each do |year_values|%>
			<tr>
				<td><%= year_values[0] %></td>
				<td><%= year_values[1] %></td>
				<td><%= year_values[2] %></td>
			</tr>
			<% sum_values += year_values[1] %>
			<% sum_values_brl += year_values[2] %>
		<% end %>
			<tr>
				<td>TOTAL</td>
				<td><%= sum_values %></td>
				<td><%= sum_values_brl %></td>
			</tr>
	</tbody>
</table>

<h4>2 - Parcelas à Receber </h4>

<table class="table table-striped">
	<thead>
		<tr>
			<th>Mês/Ano</th>
			<th>Valores - Moeda Original</th>	
		</tr>
	</thead>
	<tbody>
			<tr>
				<td></td>
				<td></td>				
			</tr>			
	</tbody>
</table>

<h3>C - Esquema de Pagamentos</h3>
<h4>1- Realizado no Exercício</h4>

<table class="table table-striped">
	<thead>
		<tr>
			<th></th>
			<th>Principal em Moeda Original</th>
			<th>Principal em R$</th>
			<th>Juros em R$</th>
			<th>Outros encargos em R$</th>
			<th>Total</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>No mês:</td>
			<td></td>
			<td><%= @debt.transaction_items_total_by 2, 2019, 2 %></td>
			<td><%= @debt.transaction_items_total_by 2, 2019, 3 %></td>
			<td><%= @debt.transaction_items_total_by 2, 2019, 4 %></td>
			<td><%= @debt.transaction_items_total_by 2, 2019 %></td>			
		</tr>

		<tr>
			<td>Até o mês:</td>
			<td></td>
			<td><%= @debt.transaction_items_total_until 2, 2019, 2 %></td>
			<td><%= @debt.transaction_items_total_until 2, 2019, 3 %></td>
			<td><%= @debt.transaction_items_total_until 2, 2019, 4 %></td>
			<td><%= @debt.transaction_items_total_until 2, 2019 %></td>			
		</tr>

	</tbody>

</table>

<h4>2- A Realizar no Exercício</h4>

<table class="table table-striped">
	<thead>
		<tr>
			<th></th>
			<th>Principal em Moeda Original</th>
			<th>Principal em R$</th>
			<th>Juros em R$</th>
			<th>Outros encargos em R$</th>
			<th>Total</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Vencido:</td>
			<td></td>
		</tr>

		<tr>
			<td>A Vencer:</td>
			<td></td>
		</tr>

		<tr>
			<td>Total:</td>
		</tr>
	</tbody>
</table>

<h4>3- A Realizar de Outros Exercícios</h4>

<table class="table table-striped">
	<thead>
		<tr>
			<th></th>
			<th>Principal em Moeda Original</th>
			<th>Principal em R$</th>
			<th>Juros em R$</th>
			<th>Outros encargos em R$</th>
			<th>Total</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>Vencido:</td>
			<td></td>
		</tr>

		<tr>
			<td>A Vencer:</td>
			<td></td>
		</tr>

		<tr>
			<td>Total:</td>
		</tr>
	</tbody>
</table>

<h4>4- A Realizar nos Próximos Exercícios</h4>

<table class="table table-striped">
	<thead>
		<tr>
			<th>Ano</th>
			<th>Principal em Moeda Original</th>
			<th>Principal em R$</th>
			<th>Juros em R$</th>
			<th>Outros encargos em R$</th>
			<th>Total</th>
		</tr>
	</thead>
	<tbody>

		<% total_principal = 0 %>
		<% total_principal_brl = 0 %>
		<% total_interest_brl = 0 %>
		<% total_charges_brl = 0 %>
		<% total = 0 %>

		<% ((Date.today.year + 1)..@debt.last_year).each do |year| %>
			
			<% list = FutureTransaction.list(@debt)%>
			<% year_total_principal = FutureTransaction.total_by year, 3, list %>
			<% year_total_principal_brl = FutureTransaction.total_by year, 3, list %>
			<% year_total_interest_brl = FutureTransaction.total_by year, 2, list %>
			<% year_total_charges_brl = FutureTransaction.total_by year, 4, list %>
			<% year_total = year_total_principal_brl + year_total_interest_brl + year_total_charges_brl %>

			<tr>			
				<td><%= year %></td>
				<td><%= big_decimal_to_currency(year_total_principal) %></td>
				<td><%= big_decimal_to_currency(year_total_principal_brl) %></td>
				<td><%= big_decimal_to_currency(year_total_interest_brl) %></td>
				<td><%= big_decimal_to_currency(year_total_charges_brl) %></td>
				<td><%= big_decimal_to_currency(year_total) %></td>
			</tr>

			<% total_principal += year_total_principal %>
			<% total_principal_brl += year_total_principal_brl %>
			<% total_interest_brl += year_total_interest_brl %>
			<% total_charges_brl += year_total_charges_brl %>
			<% total += year_total %>
		<% end %>
	</tbody>
</table>

<h4>5- Saldo Devedor</h4>

<table class="table table-striped">	
	<thead>
		<tr>
			<th>Principal em Moeda Original</th>
			<th>Principal em R$</th>
			<th>Juros em R$</th>
			<th>Outros encargos em R$</th>
			<th>Total</th>
		</tr>
	</thead>
	<tbody>
		<tr>			
			<td><%= big_decimal_to_currency(total_principal) %></td>
			<td><%= big_decimal_to_currency(total_principal_brl) %></td>
			<td><%= big_decimal_to_currency(total_interest_brl) %></td>
			<td><%= big_decimal_to_currency(total_charges_brl) %></td>
			<td><%= big_decimal_to_currency(total) %></td>
		</tr>
	</tbody>
</table>

<h3>D - Observações</h3>

<h3>E - Local e Data</h3>

<h3>F - Órgão</h3>

<h3>G - Assinatura do Responsável</h3>

<%= link_to 'Back', month_report_path(@debt.id), class: 'btn' %>
